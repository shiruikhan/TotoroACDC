{% extends 'base.html' %}
{% block title %}Consulta de Contato - Bling{% endblock %}

{% block content %}
  <div class="card">
    <h1>Consulta de Contato</h1>
    <p class="desc muted">Digite o ID do contato (Bling) e consulte os dados diretamente na API.</p>

    <div class="row">
      <input id="idInput" type="number" placeholder="ID do contato" />
      <button id="searchBtn" class="btn">Consultar</button>
    </div>

    <div id="status" class="muted" style="margin-top: 12px;">Aguardando consulta...</div>

    <pre id="result" class="result" style="display:none;"></pre>
  </div>
{% endblock %}

{% block scripts %}
<script>
  const input = document.getElementById('idInput');
  const btn = document.getElementById('searchBtn');
  const result = document.getElementById('result');
  const status = document.getElementById('status');

  function setStatus(msg, isError=false) {
    status.textContent = msg;
    status.className = isError ? 'error' : 'muted';
  }

  async function consultar() {
    const id = input.value.trim();
    if (!id) {
      setStatus('Informe um ID vÃ¡lido.', true);
      result.style.display = 'none';
      return;
    }
    setStatus('Consultando...');
    result.style.display = 'none';

    try {
      const resp = await fetch(`/api/contatos/${encodeURIComponent(id)}`);
      const data = await resp.json();
      if (!resp.ok || !data.success) {
        setStatus(data.error || 'Falha na consulta.', true);
        return;
      }
      setStatus('Consulta realizada com sucesso.');
      result.textContent = JSON.stringify(data.data, null, 2);
      result.style.display = 'block';
    } catch (e) {
      setStatus('Erro ao consultar: ' + e.message, true);
    }
  }

  btn.addEventListener('click', consultar);
  input.addEventListener('keydown', (ev) => { if (ev.key === 'Enter') consultar(); });
</script>
{% endblock %}